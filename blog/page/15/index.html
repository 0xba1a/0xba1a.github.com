
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Bala">
      
      
        <link rel="canonical" href="https://eastrivervillage.com/blog/page/15/">
      
      
        <link rel="prev" href="../../..">
      
      
        <link rel="next" href="../../tags/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../images/fabicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Blog - East River Village</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-3JJ45DK8YN"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-3JJ45DK8YN",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-3JJ45DK8YN",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#blog" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://eastrivervillage.com" title="East River Village" class="md-header__button md-logo" aria-label="East River Village" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            East River Village
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Blog
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07zm-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13zm-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87zM19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35zm4.33-2.7 1.15-2.77 2.2 2.54zm1.15-4.96-1.14-2.78 3.34.24zM9.63 18.93l2.77 1.15-2.53 2.19z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://eastrivervillage.com" title="East River Village" class="md-nav__button md-logo" aria-label="East River Village" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>

    </a>
    East River Village
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2025/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    September 2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    July 2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    November 2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2019/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    June 2019
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2018/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    October 2018
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2017/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    September 2017
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anatomy-of-linux-system-call-in-arm64" class="md-nav__link">
    <span class="md-ellipsis">
      Anatomy of Linux system call in ARM64
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="blog">Blog</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="../../../assets/author_image.jpg" alt="Bala">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-06-11 20:11:46+00:00">June 11, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              11 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="anatomy-of-linux-system-call-in-arm64"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/">Anatomy of Linux system call in ARM64</a></h2>
<p>The purpose of an Operating System is to run user applications. But the OS cannot provide user applications full control due to security reasons. So to do some privileged operations applications should ask OS to do the job on behalf of themselves. The primary interaction mechanism in Linux and similar Operating Systems is System Call. In this article we are going to see the anatomy of Linux System Calls in ARM64 architecture. Most people working with applications doesn't require it. It is only for those who have a printed copy of <code>Hitchhiker's guide to the galaxy</code>. DON'T PANIC!</p>
<p>ARMv8 has four exception levels - EL0 to EL3. EL0 has lowest privilege where user applications run. EL3 has the highest privilege for Secure Monitor firmware (usually proprietary). Hypervisor runs in EL2 for virtualisation platforms. And our beloved Linux kernel runs in EL1. Elevation from one exception level to next exception level are achieved by setting exceptions. These exceptions will be set by one level and the next level will handle it. Explaining all types of exceptions is out of the scope of this article.</p>
<p>The instruction used to set a synchronous exception [used for system call mechanism] to elevate from EL0 to EL1 is <code>svc</code> - supervisor call. Thus an application runs in Linux should issue <code>svc</code> with registers set with appropriate values. To know what are those appropriate values, Lets see how kernel handles <code>svc</code>.</p>
<h2 id="kernel-part"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#kernel-part">Kernel Part</a></h2>
<div style="color:#3273dc">
<span style="font-weight: bold;">NOTE:</span> All the code references given in this post are from Linux-4.9.57.
</div>

<h4 id="vector-table-definition-in-kernel"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#vector-table-definition-in-kernel">Vector table definition in Kernel</a></h4>
<p>As I have mentioned already, there are multiple exceptions can be set by applications [EL0] which will be taken by Kernel [EL1]. The handlers for these exceptions are stored in a vector table. In ARMv8 the register that mentions the base address of that vector table is <code>VBAR_EL1</code> [Vector Base Address Register for EL1].</p>
<p _="%" endblockquote="endblockquote">{% blockquote ARM infocenter %}
When an exception occurs, the processor must execute handler code which corresponds to the exception. The location in memory where the handler is stored is called the exception vector. In the ARM architecture, exception vectors are stored in a table, called the exception vector table. Each Exception level has its own vector table, that is, there is one for each of EL3, EL2 and EL1. The table contains instructions to be executed, rather than a set of addresses. Vectors for individual exceptions are located at fixed offsets from the beginning of the table. The virtual address of each table base is set by the Vector Based Address Registers VBAR_EL3, VBAR_EL2 and VBAR_EL1.</p>
<p>As explained above the exception-handlers reside in a continuous memory and each vector spans up to 32 instructions long. Based on type of the exception, the execution will start from an instruction in a particular offset from the base address <code>VBAR_EL1</code>. Below is the ARM64 vector table. For example when an synchronous exception is set from EL0 is set, the handler at <code>VBAR_EL1 +0x400</code> will execute to handle the exception.</p>
<table>
<thead>
<tr>
<th>Offset from VBAR_EL1</th>
<th>Exception type</th>
<th>Exception set level</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0x000</td>
<td>Synchronous</td>
<td>Current EL with SP0</td>
</tr>
<tr>
<td>+0x080</td>
<td>IRQ/vIRQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x100</td>
<td>FIQ/vFIQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x180</td>
<td>SError/vSError</td>
<td>"</td>
</tr>
<tr>
<td>+0x200</td>
<td>Synchronous</td>
<td>Current EL with SPx</td>
</tr>
<tr>
<td>+0x280</td>
<td>IRQ/vIRQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x300</td>
<td>FIQ/vFIQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x380</td>
<td>SError/vSError</td>
<td>"</td>
</tr>
<tr>
<td>+0x400</td>
<td>Synchronous</td>
<td>Lower EL using ARM64</td>
</tr>
<tr>
<td>+0x480</td>
<td>IRQ/vIRQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x500</td>
<td>FIQ/vFIQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x580</td>
<td>SError/vSError</td>
<td>"</td>
</tr>
<tr>
<td>+0x600</td>
<td>Synchronous</td>
<td>Lower EL with ARM32</td>
</tr>
<tr>
<td>+0x680</td>
<td>IRQ/vIRQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x700</td>
<td>FIQ/vFIQ</td>
<td>"</td>
</tr>
<tr>
<td>+0x780</td>
<td>SError/vSError</td>
<td>"</td>
</tr>
</tbody>
</table>
<p>Linux defines the vector table at <code>arch/arm64/kernel/entry.S +259</code>. Each <code>ventry</code> is 32 instructions long. As an instruction in ARMv8 is 4 bytes long, next <code>ventry</code> will start at +0x80 of current <code>ventry</code>.
<div class="highlight"><pre><span></span><code>ENTRY(vectors)
    ventry    el1_sync_invalid           // Synchronous EL1t
    ventry    el1_irq_invalid            // IRQ EL1t
    ventry    el1_fiq_invalid            // FIQ EL1t
    ventry    el1_error_invalid          // Error EL1t

    ventry    el1_sync                   // Synchronous EL1h
    ventry    el1_irq                    // IRQ EL1h
    ventry    el1_fiq_invalid            // FIQ EL1h
    ventry    el1_error_invalid          // Error EL1h

    ventry    el0_sync                   // Synchronous 64-bit EL0
    ventry    el0_irq                    // IRQ 64-bit EL0
    ventry    el0_fiq_invalid            // FIQ 64-bit EL0
    ventry    el0_error_invalid          // Error 64-bit EL0

#ifdef CONFIG_COMPAT
    ventry    el0_sync_compat            // Synchronous 32-bit EL0
    ventry    el0_irq_compat             // IRQ 32-bit EL0
    ventry    el0_fiq_invalid_compat     // FIQ 32-bit EL0
    ventry    el0_error_invalid_compat   // Error 32-bit EL0
#else
    ventry    el0_sync_invalid           // Synchronous 32-bit EL0
    ventry    el0_irq_invalid            // IRQ 32-bit EL0
    ventry    el0_fiq_invalid            // FIQ 32-bit EL0
    ventry    el0_error_invalid          // Error 32-bit EL0
#endif
END(vectors)
</code></pre></div>
And loads the vector table into <code>VBAR_EL1</code> at <code>arch/arm64/kernel/head.S +433</code>.
<div class="highlight"><pre><span></span><code>    adr_l   x8, vectors                 // load VBAR_EL1 with virtual
    msr     vbar_el1, x8                // vector table address
    isb
</code></pre></div>
<code>VBAR_EL1</code> is an system register. So it cannot be accessed directly. Special system instructions <code>msr</code> and <code>mrs</code> should be used manipulate system registers.</p>
<table>
<thead>
<tr>
<th>Instruction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>adr_l x8, vector</code></td>
<td>loads the address of vector table into general purpose register <code>X8</code></td>
</tr>
<tr>
<td><code>msr vbar_el1, x8</code></td>
<td>moves value in <code>X8</code> to system register <code>VBAR_EL1</code></td>
</tr>
<tr>
<td><code>isb</code></td>
<td>instruction sync barrier</td>
</tr>
</tbody>
</table>
<h4 id="system-call-flow-in-kernel"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#system-call-flow-in-kernel">System call flow in Kernel</a></h4>
<p>Now lets see what happens when an application issues the instruction <code>svc</code>. From the table, we can see for AArch64 synchronous exception from lower level, the offset is <code>+0x400</code>. In the Linux vector definition <code>VBAR_EL1+0x400</code> is <code>el0_sync</code>. Lets go to the <code>el0_sync</code> definition at <code>arch/arm64/kernel/entry.S +458</code>
<div class="highlight"><pre><span></span><code>el0_sync:
    kernel_entry 0
    mrs    x25, esr_el1                     // read the syndrome register
    lsr    x24, x25, #ESR_ELx_EC_SHIFT      // exception class
    cmp    x24, #ESR_ELx_EC_SVC64           // SVC in 64-bit state
    b.eq    el0_svc
    cmp    x24, #ESR_ELx_EC_DABT_LOW        // data abort in EL0
    b.eq    el0_da
    cmp    x24, #ESR_ELx_EC_IABT_LOW        // instruction abort in EL0
    b.eq    el0_ia
    cmp    x24, #ESR_ELx_EC_FP_ASIMD        // FP/ASIMD access
    b.eq    el0_fpsimd_acc
    cmp    x24, #ESR_ELx_EC_FP_EXC64        // FP/ASIMD exception
    b.eq    el0_fpsimd_exc
    cmp    x24, #ESR_ELx_EC_SYS64           // configurable trap
    b.eq    el0_sys
    cmp    x24, #ESR_ELx_EC_SP_ALIGN        // stack alignment exception
    b.eq    el0_sp_pc
    cmp    x24, #ESR_ELx_EC_PC_ALIGN        // pc alignment exception
    b.eq    el0_sp_pc
    cmp    x24, #ESR_ELx_EC_UNKNOWN         // unknown exception in EL0
    b.eq    el0_undef
    cmp    x24, #ESR_ELx_EC_BREAKPT_LOW     // debug exception in EL0
    b.ge    el0_dbg
    b    el0_inv
</code></pre></div>
The subroutine is nothing but a bunch of <code>if</code> conditions. The synchronous exception can have multiple reasons which will be  stored in the syndrome register <code>esr_el1</code>. Compare the value in syndrome register with predefined macros and branch to the corresponding subroutine.</p>
<table>
<thead>
<tr>
<th>Instruction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kernel_entry 0</code></td>
<td>It is a macro defined at<br/><code>arch/arm64/kernel/entry.S +71</code>. It stores<br/>all the general purpose registers into<br/>CPU stack as the sys_* function<br/>expects its arguments from<br/>CPU stack only</td>
</tr>
<tr>
<td><code>mrs x25, esr_el1</code></td>
<td>Move system register <code>esr_el1</code> to general<br/>purpose register <code>X25</code>. <code>esr_el1</code> is the exception <br/>syndrome register. It will have the syndrome code <br/>that caused the exception.</td>
</tr>
<tr>
<td><code>lsr x24, x25, #ESR_ELx_EC_SHIFT</code></td>
<td>Left shift <code>X25</code> by <code>ESR_ELx_EC_SHIFT</code> bits <br/>and store the result in <code>X24</code></td>
</tr>
<tr>
<td><code>cmp x24, #ESR_ELx_EC_SVC64</code></td>
<td>Compare the value in <code>X24</code> with <code>ESR_ELx_EC_SVC64</code>. <br/>If both are equal <code>Z</code> bit will be set in <code>NZCV</code> <br/>special purpose register.</td>
</tr>
<tr>
<td><code>b.eq el0_svc</code></td>
<td>If <code>Z</code> flag is set in <code>NZCV</code>, branch to <code>el0_svc</code>. <br/>It is just <code>b</code> not <code>bl</code>. So the control will not come <br/>back to caller. The condition check will happen until <br/>it finds the appropriate reason. If all are wrong <code>el0_inv</code> <br/>will be called.</td>
</tr>
</tbody>
</table>
<p>In a system call case, control will be branched to <code>el0_svc</code>. It is defined at <code>arm64/kernel/entry.S +742</code> as follows
<div class="highlight"><pre><span></span><code>/*
 * SVC handler.
 */
    .align    6
el0_svc:
    adrp    stbl, sys_call_table            // load syscall table pointer
    uxtw    scno, w8                        // syscall number in w8
    mov     sc_nr, #__NR_syscalls
el0_svc_naked:                              // compat entry point
    stp     x0, scno, [sp, #S_ORIG_X0]      // save the original x0 and syscall number    enable_dbg_and_irq
    ct_user_exit 1

    ldr     x16, [tsk, #TI_FLAGS]           // check for syscall hooks
    tst     x16, #_TIF_SYSCALL_WORK
    b.ne    __sys_trace
    cmp     scno, sc_nr                     // check upper syscall limit
    b.hs    ni_sys
    ldr     x16, [stbl, scno, lsl #3]       // address in the syscall table
    blr     x16                             // call sys_* routine
    b       ret_fast_syscall
ni_sys:
    mov     x0, sp
    bl      do_ni_syscall
    b       ret_fast_syscall
ENDPROC(el0_svc)
</code></pre></div>
Before going through the code, let me introduce the aliases
<code>arch/arm64/kernel/entry.S +229</code>
<div class="highlight"><pre><span></span><code>/*
 * These are the registers used in the syscall handler, and allow us to
 * have in theory up to 7 arguments to a function - x0 to x6.
 *
 * x7 is reserved for the system call number in 32-bit mode.
 */
sc_nr   .req    x25        // number of system calls
scno    .req    x26        // syscall number
stbl    .req    x27        // syscall table pointer
tsk     .req    x28        // current thread_info
</code></pre></div>
Now lets walk through function <code>el0_svc</code>,</p>
<table>
<thead>
<tr>
<th>Instruction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>adrp stbl, sys_call_table</code></td>
<td>I'll come to the <code>sys_call_table</code> in next section. <br/>It is the table indexed with syscall number and <br/>corresponding function. It has to be in a <br/>4K aligned memory. Thus this instruction adds the top <br/>22-bits of <code>sys_call_table</code> address with top 52-bit of <br/><code>PC</code> (program counter) and stores the value at <code>stbl</code>. <br/>Actually it forms the PC-relative address to 4KB page.</td>
</tr>
<tr>
<td><code>uxtw scno, w8</code></td>
<td>unsigned extract from 32-bit word. <br/>Read 32-bit form of General purpose register <code>X8</code> <br/>and store it in <code>scno</code></td>
</tr>
<tr>
<td><code>mov sc_nr, #__NR_syscalls</code></td>
<td>Load <code>sc_nr</code> with number of system calls</td>
</tr>
<tr>
<td><code>stp x0, scno, [sp, #S_ORIG_X0]</code></td>
<td>Store a pair of registers <code>X0</code> and <code>scno</code> <br/>at the memory location stack-pointer + <code>S_ORIG_X0</code>. <br/>Value of <code>S_ORIG_X0</code> is not really important. <br/>As long as stack-pointer is not modified, <br/>we can access the stored values anytime.</td>
</tr>
<tr>
<td><code>enable_dbg_and_irq</code></td>
<td>it is a macro defined at <br/><code>arch/arm64/include/asm/assembler.h +88</code>. <br/>It actually enables IRQ and <br/>debugging by setting appropriate <br/>value at special purpose register <code>DAIF</code>.</td>
</tr>
<tr>
<td><code>ct_user_exit 1</code></td>
<td>another macro not much important <br/>unless you bother about <code>CONFIG_CONTEXT_TRACKING</code></td>
</tr>
<tr>
<td><code>ldr x16, [tsk, #TI_FLAGS]</code><br/> <code>tst x16, #_TIF_SYSCALL_WORK</code> <br/><code>b.ne __sys_trace</code></td>
<td>These instructions are related to syscall hooks. <br/>If syscall hooks are set, call <code>__sys_trace</code>. <br/>For those who got confused about <code>b.ne</code> like me, <br/><code>.ne</code> only check whether <code>Z</code> flag is non zero. <br/><code>tst</code> instruction does an bitwise AND of both <br/>operands. If both are equal, <code>Z</code> flag will be non zero.</td>
</tr>
<tr>
<td><code>cmp scno, sc_nr</code> <br/><code>b.hs ni_sys</code></td>
<td>Just an error check. If the <br/>syscall number is greater than<br/><code>sc_nr</code> go to <code>ni_sys</code></td>
</tr>
<tr>
<td><code>ldr x16, [stbl, scno, lsl #3]</code></td>
<td>Load the address of corresponding <br/><code>sys_*</code> function into <code>X16</code>.<br/>Will explain detail in next section</td>
</tr>
<tr>
<td><code>blr x16</code></td>
<td>subroutine call to the actual <code>sys_*</code> <br/>function</td>
</tr>
<tr>
<td><code>b ret_fast_syscall</code></td>
<td>Maybe a house-keeping function. <br/>Control will not flow further down.</td>
</tr>
</tbody>
</table>
<h4 id="sys_call_table"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#sys_call_table">sys_call_table</a></h4>
<p>It is nothing but an array of function pointer indexed with the system call number. It has to be placed in an 4K aligned memory. For ARM64 <code>sys_call_table</code> is defined at <code>arch/arm64/kernel/sys.c +55</code>.
<div class="highlight"><pre><span></span><code>#undef __SYSCALL
#define __SYSCALL(nr, sym)  [nr] = sym,

/*
 * The sys_call_table array must be 4K aligned to be accessible from
 * kernel/entry.S.
 */
void * const sys_call_table[__NR_syscalls] __aligned(4096) = {
    [0 ... __NR_syscalls - 1] = sys_ni_syscall,
#include &lt;asm/unistd.h&gt;
};
</code></pre></div>
 * <code>__NR_syscalls</code> defines the number of system call. This varies from architecture to architecture.
 * Initially all the system call numbers were set <code>sys_ni_syscall</code> - not implemented system call. If a system call is removed, its system call number will not be reused. Instead it will be assigned with <code>sys_ni_syscall</code> function.
 * And the include goes like this <code>arch/arm64/include/asm/unistd.h</code> -&gt; <code>arch/arm64/include/uapi/asm/unistd.h</code> -&gt; <code>include/asm-generic/unistd.h</code> -&gt; <code>include/uapi/asm-generic/unistd.h</code>. The last file has the definition of all system calls. For example the <code>write</code> system call is defined here as
<div class="highlight"><pre><span></span><code>#define __NR_write 64
__SYSCALL(__NR_write, sys_write)
</code></pre></div>
 * The <code>sys_call_table</code> is an array of function pointers. As in ARM64 a function pointer is 8 bytes long, to calculate the address of actual system call, system call number <code>scno</code> is left shifted by 3 and added with system call table address <code>stbl</code> in the <code>el0_svc</code> subroutine - <code>ldr x16, [stbl, scno, lsl #3]</code></p>
<h4 id="system-call-definition"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#system-call-definition">System call definition</a></h4>
<p>Each system call is defined with a macro <code>SYSCALL_DEFINEn</code> macro. <code>n</code> is corresponding to the number of arguments the system call accepts. For example the <code>write</code> is implemented at <code>fs/read_write.c +599</code>
<div class="highlight"><pre><span></span><code>SYSCALL_DEFINE3(write, unsigned int, fd, const char __user *, buf,
        size_t, count)
{
    struct fd f = fdget_pos(fd);
    ssize_t ret = -EBADF;

    if (f.file) {
        loff_t pos = file_pos_read(f.file);
        ret = vfs_write(f.file, buf, count, &amp;pos);
        if (ret &gt;= 0)
            file_pos_write(f.file, pos);
        fdput_pos(f);
    }

    return ret;
}
</code></pre></div>
This macro will expand into <code>sys_write</code> function definition and other aliases functions as mentioned in this <a href="https://lwn.net/Articles/604287/">LWN article</a>. The expanded function will have the compiler directive <code>asmlinkage</code> set. It instructs the compiler to look for arguments in CPU stack instead of registers. This is to implement system calls architecture independent. That's why <code>kernel_entry</code> macro in <code>el0_sync</code> pushed all general purpose registers into stack. In ARM64 case registers <code>X0</code> to <code>X7</code> will have the arguments.</p>
<h2 id="application-part"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#application-part">Application part</a></h2>
<p>An user application should do following steps to make a system call
 * Set the lower 32-bit of general purpose register <code>X8</code> with appropriate system call number - <code>el0_svc</code> loads the system call number from <code>W0</code>
 * And then issue the <code>svc</code> instruction
 * Now kernel implemented <code>sys_*</code> function will run on behalf of the application</p>
<p>Normally all the heavy lifting will be done by the <code>glibc</code> library. Dependency on <code>glibc</code> also makes the application portable across platforms having <code>glibc</code> support. Each platform will have different system call number and <code>glibc</code> takes care of that while compiling.</p>
<h4 id="printf-implementation"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#printf-implementation"><code>printf</code> implementation</a></h4>
<p>In this section we'll see how <code>glibc</code> implements the <code>printf</code> system call. Going deep into all <code>glibc</code> macro expansion is out of scope of this post. End of the day <code>printf</code> has to be a <code>write</code> towards the <code>stdout</code> file. Lets see that.</p>
<p>Wrote a simple hello world program.
<div class="highlight"><pre><span></span><code>kaba@kaba-Vostro-1550:~/Desktop/workbench/code
$<span class="w"> </span>cat<span class="w"> </span>syscall.c
<span class="c1">#include &lt;stdio.h&gt;</span>

int<span class="w"> </span>main<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>printf<span class="o">(</span><span class="s2">&quot;Hello world!\n&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
kaba@kaba-Vostro-1550:~/Desktop/workbench/code
$<span class="w"> </span>
</code></pre></div>
Compile it with symbols and export it to an ARM64 target [Raspberry Pi 3 in my case]. Run it in the target with <code>gdbserver</code> and connect remote GDB as mentioned in previous <a href="http://eastrivervillage.com/debugging-application-with-cross-gdb-yocto/">post</a>.</p>
<p>The last function in <code>glibc</code> that issues <code>svc</code> is <code>__GI___libc_write</code>. I got this with the help of <code>GDB</code>. If you really want to go through <code>glibc</code> code to trace this function all the way from <code>printf</code>, prepare yourself. Here is the <code>GDB</code> backtrace output.
<div class="highlight"><pre><span></span><code>(gdb) bt
#0  __GI___libc_write (fd=1, buf=0x412260, nbytes=13) at /usr/src/debug/glibc/2.26-r0/git/sysdeps/unix/sysv/linux/write.c:26
#1  0x0000007fb7eeddcc in _IO_new_file_write (f=0x7fb7fcd540 &lt;_IO_2_1_stdout_&gt;, data=0x412260, n=13) at /usr/src/debug/glibc/2.26-r0/git/libio/fileops.c:1255
#2  0x0000007fb7eed160 in new_do_write (fp=0x7fb7fcd540 &lt;_IO_2_1_stdout_&gt;, data=0x412260 &quot;Hello world!\n&quot;, to_do=to_do@entry=13) at /usr/src/debug/glibc/2.26-r0/git/libio/fileops.c:510
#3  0x0000007fb7eeefc4 in _IO_new_do_write (fp=fp@entry=0x7fb7fcd540 &lt;_IO_2_1_stdout_&gt;, data=&lt;optimized out&gt;, to_do=13) at /usr/src/debug/glibc/2.26-r0/git/libio/fileops.c:486
#4  0x0000007fb7eef3f0 in _IO_new_file_overflow (f=0x7fb7fcd540 &lt;_IO_2_1_stdout_&gt;, ch=10) at /usr/src/debug/glibc/2.26-r0/git/libio/fileops.c:851
#5  0x0000007fb7ee3d78 in _IO_puts (str=0x400638 &quot;Hello world!&quot;) at /usr/src/debug/glibc/2.26-r0/git/libio/ioputs.c:41
#6  0x0000000000400578 in main () at syscall.c:5
</code></pre></div>
 Lets us see the assembly instructions of <code>__GI_libc_write</code> function in GDB TUI.
<div class="highlight"><pre><span></span><code>   |0x7fb7f407a8 &lt;__GI___libc_write&gt;        stp    x29, x30, [sp, #-48]!
  &gt;│0x7fb7f407ac &lt;__GI___libc_write+4&gt;      adrp   x3, 0x7fb7fd1000 &lt;__libc_pthread_functions+184&gt;
   │0x7fb7f407b0 &lt;__GI___libc_write+8&gt;      mov    x29, sp
   │0x7fb7f407b4 &lt;__GI___libc_write+12&gt;     str    x19, [sp, #16]
   │0x7fb7f407b8 &lt;__GI___libc_write+16&gt;     sxtw   x19, w0
   │0x7fb7f407bc &lt;__GI___libc_write+20&gt;     ldr    w0, [x3, #264]
   │0x7fb7f407c0 &lt;__GI___libc_write+24&gt;     cbnz   w0, 0x7fb7f407f0 &lt;__GI___libc_write+72&gt;
   │0x7fb7f407c4 &lt;__GI___libc_write+28&gt;     mov    x0, x19
   │0x7fb7f407c8 &lt;__GI___libc_write+32&gt;     mov    x8, #0x40                       // #64
   │0x7fb7f407cc &lt;__GI___libc_write+36&gt;     svc    #0x0
   .
   .
   .
</code></pre></div></p>
<table>
<thead>
<tr>
<th>Instruction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>stp    x29, x30, [sp, #-48]!</td>
<td>Increment stack pointer and back-up<br/>frame-pointer and link-register</td>
</tr>
<tr>
<td>adrp   x3, 0x7fb7fd1000</td>
<td>Load the PC related address<br/>of <code>SINGLE_THREAD_P</code></td>
</tr>
<tr>
<td>mov    x29, sp</td>
<td>Move current stack-pointer<br/>into frame-pointer</td>
</tr>
<tr>
<td>str    x19, [sp, #16]</td>
<td>Backup <code>X19</code> in stack</td>
</tr>
<tr>
<td>sxtw   x19, w0</td>
<td>Backup <code>W0</code> into <code>X19</code><br/> the first parameter<br/>This function has 3 parameters<br/>So they will be in <code>X0</code>, <code>X1</code><br/>and<code>X2</code>. Thus they have to be<br/>backed-up before using</td>
</tr>
<tr>
<td>ldr    w0, [x3, #264]</td>
<td>Load the global into <code>W0</code><br/>This global tells whether<br/>it is a multi-threaded<br/>program</td>
</tr>
<tr>
<td>cbnz   w0, 0x7fb7f407f0</td>
<td>Conditional branch if <code>W0</code><br/>is non zero<br/>Actually a jump in case of<br/>multi-threaded program.<br/>Our case is single threaded.<br/>So fall through</td>
</tr>
<tr>
<td>mov    x0, x19</td>
<td>Restore <code>X19</code> into <code>X0</code>.<br/>The first argument.<br/>Here the <code>fd</code></td>
</tr>
<tr>
<td>mov    x8, #0x40</td>
<td>Load <code>X8</code> with the value <code>0x40</code>.<br/>Kernel will look<br/>for the system call number<br/>at <code>X8</code>. So we load it with 64<br/>which is the system call<br/>number of <code>write</code></td>
</tr>
<tr>
<td>svc    #0x0</td>
<td>All set. Now <br/><code>supervisor call</code></td>
</tr>
</tbody>
</table>
<p>From this point the almighty Linux kernel takes control. Pretty long article ahh!. At last the improbable drive comes to equilibrium as you complete this.</p>
<h2 id="references"><a class="toclink" href="../../2018/06/11/anatomy-of-linux-system-call-in-arm64/#references">References</a></h2>
<ul>
<li>http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.den0024a/ch09s01s01.html</li>
<li>http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.den0024a/CHDEEDDC.html</li>
<li>https://lwn.net/Articles/604287/</li>
<li>https://courses.cs.washington.edu/courses/cse469/18wi/Materials/arm64.pdf</li>
<li>http://www.osteras.info/personal/2013/10/11/hello-world-analysis.html</li>
<li>And the Linux kernel source. Thanks to https://elixir.bootlin.com</li>
</ul>
<div class="flex">
        <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
        <script type="IN/Share" data-url="https://eastrivervillage.com/blog/2018/06/11/anatomy-of-linux-system-call-in-arm64/"></script>
    </div>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../13/">13</a> <a class="md-pagination__link" href="../14/">14</a> <span class="md-pagination__current">15</span> <a class="md-pagination__link" href="../16/">16</a> <a class="md-pagination__link" href="../17/">17</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../27/">27</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://www.linkedin.com/in/balakumaran-kannan/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/0xba1a" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>