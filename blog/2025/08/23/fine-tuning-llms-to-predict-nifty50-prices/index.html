
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Learn how to fine-tune LLMs with historical NIFTY50 data to predict stock prices and assess its performance through backtesting.">
      
      
        <meta name="author" content="Bala">
      
      
        <link rel="canonical" href="https://eastrivervillage.com/blog/2025/08/23/fine-tuning-llms-to-predict-nifty50-prices/">
      
      
        <link rel="prev" href="../../../../2021/07/31/windows-10-port-forwarding/">
      
      
        <link rel="next" href="../../25/fine-tuning-gpt-model-to-predict-nifty50-prices/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../images/fabicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Fine-Tuning LLMs to Predict NIFTY50 Prices - East River Village</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-3JJ45DK8YN"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-3JJ45DK8YN",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-3JJ45DK8YN",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fine-tuning-llms-to-predict-nifty50-price" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://eastrivervillage.com" title="East River Village" class="md-header__button md-logo" aria-label="East River Village" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            East River Village
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fine-Tuning LLMs to Predict NIFTY50 Prices
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07zm-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13zm-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87zM19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35zm4.33-2.7 1.15-2.77 2.2 2.54zm1.15-4.96-1.14-2.78 3.34.24zM9.63 18.93l2.77 1.15-2.53 2.19z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://eastrivervillage.com" title="East River Village" class="md-nav__button md-logo" aria-label="East River Village" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>

    </a>
    East River Village
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    September 2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    July 2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    November 2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    June 2019
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2018/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    October 2018
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2017/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10.41 7.41 15 12l-4.59 4.6L9 15.18 12.18 12 9 8.82M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
  
  <span class="md-ellipsis">
    September 2017
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-preperation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Preperation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="../../../../../assets/author_image.jpg" alt="Bala">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          <a href="https://eastrivervillage.com">Bala</a>
                        
                      </strong>
                      <br>
                      Principal Software Engineer @ Microsoft
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2025-08-23 00:00:00+00:00" class="md-ellipsis">August 23, 2025</time>
                      </div>
                    </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              13 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../tags/#tag:azure" class="md-tag">Azure</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:fine-tuning" class="md-tag">Fine-Tuning</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:llm" class="md-tag">LLM</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:nifty50" class="md-tag">NIFTY50</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:stock-market" class="md-tag">Stock Market</a>
      
    
      
      
      
        <a href="../../../../tags/#tag:time-series" class="md-tag">Time Series</a>
      
    
  </nav>



<h1 id="fine-tuning-llms-to-predict-nifty50-price">Fine Tuning LLMs to Predict NIFTY50 Price</h1>
<p>Language has developed naturally over time, without strict rules in its early stages. This makes it one of the first structured systems shaped by human behavior. By studying language, we can uncover patterns in human thinking and actions. Large Language Models (LLMs) have shown impressive abilities to understand and predict human language. In a similar way, business systems like pricing have also evolved organically. Pricing patterns existed long before formal accounting rules were created. If LLMs can predict the next word in a sentence by understanding language patterns, could they also predict the next price using historical data? This article dives into how LLMs can be trained and fine-tuned to analyze NIFTY50 price trends and predict future movements, exploring its potential in financial markets.</p>
<p>My focus here is only Intraday trading. Because we don't have any price value for NIFTY in the closed hours of market and there can be too many factors affecting the next day opening price. So, trying to predict price across days with current data is nothing but halucination.</p>
<p>Our system will keep watching the market movement until 2.30 PM. And based on the movement so far, it will make a call or put at 2.30 and square off before the market ends. We'll ask the model to predit a target price. There will be a stop-loss calculated programatically. Additionally, the cutoff time will be 3.25 PM to close the position. So, if neither target price or stop-loss is reached, the position will be squared off for whatever price at 3.25 PM.</p>
<h2 id="data-preperation">Data Preperation</h2>
<p>The performance of a model is relying only on the data it is trained. So, collecting and preparing the historical Nifty50 data is very crucial. Simply dumping the historical data to any LLM won't make any good other than getting you pay for the GPUs.</p>
<p>Prepare the environment
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w"> </span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="w"> </span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
<span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pandas
</code></pre></div></td></tr></table></div></p>
<p>I took the 9 years of Nifty-50 candlestick data from this <a href="https://github.com/sandeepkapri/Nifty50-Minute-Data">GitHub repo</a>. It has minute level Open, High, Low and Close information for every market functioning day. We just need one number per minute. So, let's remove everything else other than open.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">candle_stick_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;dataset/nifty50_candlestick_data.csv&quot;</span><span class="p">)</span>
<span class="n">candle_stick_data</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">candle_stick_data</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">candle_stick_data</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y %H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">candle_stick_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">candle_stick_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;Instrument&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">n50_minute_level_opens</span> <span class="o">=</span> <span class="n">candle_stick_data</span>
<span class="n">n50_minute_level_opens</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<strong>Output</strong></p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09 09:15:00</th>
      <td>8285.45</td>
    </tr>
    <tr>
      <th>2015-01-09 09:16:00</th>
      <td>8292.60</td>
    </tr>
    <tr>
      <th>2015-01-09 09:17:00</th>
      <td>8287.40</td>
    </tr>
    <tr>
      <th>2015-01-09 09:18:00</th>
      <td>8294.25</td>
    </tr>
    <tr>
      <th>2015-01-09 09:19:00</th>
      <td>8300.60</td>
    </tr>
  </tbody>
</table>
</div>

<p><br /></p>
<p>We need to train the model on daily movements. So, the data should be grouped date-wise. In the dataset the second value is not proper. As we don't worry much about the second, we'll unify that to the the minute. Also, remove any data that is beyond typical Indian market hours.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">market_hours_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">n50_minute_level_opens</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;09:15:00&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">&amp;</span> \
                      <span class="p">(</span><span class="n">n50_minute_level_opens</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;15:30:00&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

<span class="n">n50_min_opens</span> <span class="o">=</span> <span class="n">n50_minute_level_opens</span><span class="p">[</span><span class="n">market_hours_filter</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">n50_min_opens</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n50_min_opens</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span>
<span class="n">n50_min_opens</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n50_min_opens</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M&#39;</span><span class="p">)</span>

<span class="n">n50_daily_opens</span> <span class="o">=</span> <span class="n">n50_min_opens</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;first&#39;</span>  <span class="c1"># In case there are duplicates, take the first value</span>
<span class="p">)</span>

<span class="n">n50_daily_opens</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<strong>Output</strong></p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>time</th>
      <th>09:15</th>
      <th>09:16</th>
      <th>09:17</th>
      <th>09:18</th>
      <th>09:19</th>
      <th>09:20</th>
      <th>09:21</th>
      <th>09:22</th>
      <th>09:23</th>
      <th>09:24</th>
      <th>...</th>
      <th>15:20</th>
      <th>15:21</th>
      <th>15:22</th>
      <th>15:23</th>
      <th>15:24</th>
      <th>15:25</th>
      <th>15:26</th>
      <th>15:27</th>
      <th>15:28</th>
      <th>15:29</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09</th>
      <td>8285.45</td>
      <td>8292.60</td>
      <td>8287.40</td>
      <td>8294.25</td>
      <td>8300.6</td>
      <td>8300.50</td>
      <td>8300.65</td>
      <td>8302.45</td>
      <td>8294.85</td>
      <td>8295.20</td>
      <td>...</td>
      <td>8280.8</td>
      <td>8282.35</td>
      <td>8283.40</td>
      <td>8284.35</td>
      <td>8286.9</td>
      <td>8286.65</td>
      <td>8283.45</td>
      <td>8282.35</td>
      <td>8283.25</td>
      <td>8280.50</td>
    </tr>
    <tr>
      <th>2015-01-12</th>
      <td>8291.35</td>
      <td>8254.20</td>
      <td>8255.25</td>
      <td>8258.15</td>
      <td>8263.2</td>
      <td>8267.45</td>
      <td>8266.05</td>
      <td>8268.80</td>
      <td>8273.85</td>
      <td>8266.75</td>
      <td>...</td>
      <td>8329.5</td>
      <td>8326.55</td>
      <td>8328.05</td>
      <td>8328.05</td>
      <td>8327.2</td>
      <td>8330.20</td>
      <td>8330.90</td>
      <td>8329.95</td>
      <td>8329.95</td>
      <td>8328.85</td>
    </tr>
    <tr>
      <th>2015-01-13</th>
      <td>8346.15</td>
      <td>8355.15</td>
      <td>8348.70</td>
      <td>8344.50</td>
      <td>8342.5</td>
      <td>8340.35</td>
      <td>8339.75</td>
      <td>8340.45</td>
      <td>8333.30</td>
      <td>8326.05</td>
      <td>...</td>
      <td>8304.9</td>
      <td>8305.75</td>
      <td>8306.50</td>
      <td>8307.15</td>
      <td>8308.0</td>
      <td>8308.20</td>
      <td>8308.25</td>
      <td>8307.25</td>
      <td>8305.85</td>
      <td>8308.20</td>
    </tr>
    <tr>
      <th>2015-01-14</th>
      <td>8307.25</td>
      <td>8300.85</td>
      <td>8307.00</td>
      <td>8309.05</td>
      <td>8305.4</td>
      <td>8304.70</td>
      <td>8302.20</td>
      <td>8293.10</td>
      <td>8296.70</td>
      <td>8306.85</td>
      <td>...</td>
      <td>8280.1</td>
      <td>8278.90</td>
      <td>8280.90</td>
      <td>8283.60</td>
      <td>8284.3</td>
      <td>8285.35</td>
      <td>8285.50</td>
      <td>8286.95</td>
      <td>8288.30</td>
      <td>8288.90</td>
    </tr>
    <tr>
      <th>2015-01-15</th>
      <td>8425.20</td>
      <td>8440.45</td>
      <td>8394.35</td>
      <td>8386.05</td>
      <td>8401.1</td>
      <td>8428.00</td>
      <td>8408.25</td>
      <td>8398.00</td>
      <td>8416.70</td>
      <td>8421.95</td>
      <td>...</td>
      <td>8497.6</td>
      <td>8491.80</td>
      <td>8482.05</td>
      <td>8477.25</td>
      <td>8468.0</td>
      <td>8463.80</td>
      <td>8469.05</td>
      <td>8464.80</td>
      <td>8467.25</td>
      <td>8467.45</td>
    </tr>
  </tbody>
</table>
</div>

<p><br /></p>
<p>This data is very refreshing. Nifty50 was in its eight thousands in 2015. If you have invested in the index, you would've trippled your money in the past 10 years. This gives us a small problem. I try to make the LLM to understand the trend in human price setting behaviour. Whether the price is 8000 or 24000, the trend should be same. But if I pass different prices (tokens), LLM may consider them as different behaviours. This may lead to a situation where LLM will give less importance to the original feature that defines the trend.</p>
<p>So, I decide to pass the price difference in percentage instead of passing the price itself. The idea here is to keep the open price at 9.15 as the reference and calculate the difference in percentage for 9:16. Then using price of 9.16 as reference calculate the different for 9.17. Like this we continue for the whole day with respective to the previous minute price. My assumption is whatever the price is, we humans tend to set the new price relatively.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Calculate percentage price movements within each day</span>
<span class="c1"># For each day, calculate percentage change from previous minute</span>
<span class="n">n50_daily_price_movements</span> <span class="o">=</span> <span class="n">n50_daily_opens</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_method</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Set the first column (first minute of each day) to 0 as there&#39;s no reference price</span>
<span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<strong>Output</strong></p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>time</th>
      <th>09:15</th>
      <th>09:16</th>
      <th>09:17</th>
      <th>09:18</th>
      <th>09:19</th>
      <th>09:20</th>
      <th>09:21</th>
      <th>09:22</th>
      <th>09:23</th>
      <th>09:24</th>
      <th>...</th>
      <th>15:20</th>
      <th>15:21</th>
      <th>15:22</th>
      <th>15:23</th>
      <th>15:24</th>
      <th>15:25</th>
      <th>15:26</th>
      <th>15:27</th>
      <th>15:28</th>
      <th>15:29</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09</th>
      <td>0.0</td>
      <td>0.086296</td>
      <td>-0.062707</td>
      <td>0.082656</td>
      <td>0.076559</td>
      <td>-0.001205</td>
      <td>0.001807</td>
      <td>0.021685</td>
      <td>-0.091539</td>
      <td>0.004219</td>
      <td>...</td>
      <td>-0.008453</td>
      <td>0.018718</td>
      <td>0.012678</td>
      <td>0.011469</td>
      <td>0.030781</td>
      <td>-0.003017</td>
      <td>-0.038616</td>
      <td>-0.013279</td>
      <td>0.010866</td>
      <td>-0.033200</td>
    </tr>
    <tr>
      <th>2015-01-12</th>
      <td>0.0</td>
      <td>-0.448057</td>
      <td>0.012721</td>
      <td>0.035129</td>
      <td>0.061152</td>
      <td>0.051433</td>
      <td>-0.016934</td>
      <td>0.033269</td>
      <td>0.061073</td>
      <td>-0.085813</td>
      <td>...</td>
      <td>0.042037</td>
      <td>-0.035416</td>
      <td>0.018015</td>
      <td>0.000000</td>
      <td>-0.010206</td>
      <td>0.036027</td>
      <td>0.008403</td>
      <td>-0.011403</td>
      <td>0.000000</td>
      <td>-0.013205</td>
    </tr>
    <tr>
      <th>2015-01-13</th>
      <td>0.0</td>
      <td>0.107834</td>
      <td>-0.077198</td>
      <td>-0.050307</td>
      <td>-0.023968</td>
      <td>-0.025772</td>
      <td>-0.007194</td>
      <td>0.008394</td>
      <td>-0.085727</td>
      <td>-0.087000</td>
      <td>...</td>
      <td>0.080137</td>
      <td>0.010235</td>
      <td>0.009030</td>
      <td>0.007825</td>
      <td>0.010232</td>
      <td>0.002407</td>
      <td>0.000602</td>
      <td>-0.012036</td>
      <td>-0.016853</td>
      <td>0.028293</td>
    </tr>
    <tr>
      <th>2015-01-14</th>
      <td>0.0</td>
      <td>-0.077041</td>
      <td>0.074089</td>
      <td>0.024678</td>
      <td>-0.043928</td>
      <td>-0.008428</td>
      <td>-0.030103</td>
      <td>-0.109610</td>
      <td>0.043410</td>
      <td>0.122338</td>
      <td>...</td>
      <td>0.078563</td>
      <td>-0.014493</td>
      <td>0.024158</td>
      <td>0.032605</td>
      <td>0.008450</td>
      <td>0.012675</td>
      <td>0.001810</td>
      <td>0.017500</td>
      <td>0.016291</td>
      <td>0.007239</td>
    </tr>
    <tr>
      <th>2015-01-15</th>
      <td>0.0</td>
      <td>0.181005</td>
      <td>-0.546179</td>
      <td>-0.098876</td>
      <td>0.179465</td>
      <td>0.320196</td>
      <td>-0.234338</td>
      <td>-0.121904</td>
      <td>0.222672</td>
      <td>0.062376</td>
      <td>...</td>
      <td>-0.042347</td>
      <td>-0.068255</td>
      <td>-0.114817</td>
      <td>-0.056590</td>
      <td>-0.109116</td>
      <td>-0.049598</td>
      <td>0.062029</td>
      <td>-0.050183</td>
      <td>0.028943</td>
      <td>0.002362</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's analyze the price movement for insights. Since the true value of an asset (like Nifty50) is often unclear, we use the current and previous prices as proxies—a concept tied to Daniel Kahneman's Anchoring Bias. This bias suggests that sudden price increases are likely to be corrected downward, while sharp decreases are adjusted upward. As a result, the average price movement should ideally converge to zero.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Calculate statistics excluding NaN values and the first column (which is all zeros)</span>
<span class="n">movements_data</span> <span class="o">=</span> <span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Exclude first column</span>
<span class="n">movements_data_clean</span> <span class="o">=</span> <span class="n">movements_data</span><span class="p">[</span><span class="o">~</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">movements_data</span><span class="p">)]</span>  <span class="c1"># Remove NaN values</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total data points: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">movements_data_clean</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean movement: </span><span class="si">{</span><span class="n">movements_data_clean</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Std deviation: </span><span class="si">{</span><span class="n">movements_data_clean</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min movement: </span><span class="si">{</span><span class="n">movements_data_clean</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max movement: </span><span class="si">{</span><span class="n">movements_data_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<strong>Output</strong>
<div class="highlight"><pre><span></span><code>Total<span class="w"> </span>data<span class="w"> </span>points:<span class="w"> </span><span class="m">849</span>,150
Mean<span class="w"> </span>movement:<span class="w"> </span>-0.0002%
Std<span class="w"> </span>deviation:<span class="w"> </span><span class="m">0</span>.0409%
Min<span class="w"> </span>movement:<span class="w"> </span>-2.4480%
Max<span class="w"> </span>movement:<span class="w"> </span><span class="m">6</span>.2991%
</code></pre></div></p>
<p>Our assumption didn't go wrong. The mean value is very close to zero, -0.0002%. If you see the standard deviation, it is around 0.04%. It means in the last 10 years, for more than 68% percentage of the time we quoated the new price with is ±0.04% relative to the current price.</p>
<p><em>Note: In our case the ±1σ is 82.69%. It means 82% of times we qouted the new price within ±0.04% of the current price. Similarly Nifty50 movement distribution's ±2σ is 96.01% whereas typical distribution is 95.45%. At 2σ only the price movement converges to normal statistics. The ±3σ is 98.64% but normal is 99.73% - we have more outliers here.</em></p>
<p><strong>This insight reveals that we tend to adopt a more cautious approach under normal circumstances. However, when pushed to the edge, we take significantly higher risks. The difference in the 3σ range is notable. While 4.28% of data points are expected in this range, only 2.63% are present—nearly half are missing. This suggests that when we decide to take risks, we often overextend, taking unnecessary risks about 50% of the time.</strong></p>
<p><em>I'm leaving it as an excercise for you to calculate the ranges yourself.</em></p>
<p>Let's clean the data.</p>
<ol>
<li>Fill any NaN with previous value</li>
<li>Fix the precision to two decimal degits. <em>It's safe to have 0.04% as our approximate std.</em>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Fill NaN values with previous value (forward fill along rows)</span>
<span class="n">n50_daily_price_movements</span> <span class="o">=</span> <span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Round to 2 decimal places</span>
<span class="n">n50_daily_price_movements</span> <span class="o">=</span> <span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Price movements DataFrame shape: </span><span class="si">{</span><span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NaN values remaining: </span><span class="si">{</span><span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<strong>Output</strong>
<div class="highlight"><pre><span></span><code>Price movements DataFrame shape: (2273, 375)
NaN values remaining: 0
</code></pre></div></li>
</ol>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>time</th>
      <th>09:15</th>
      <th>09:16</th>
      <th>09:17</th>
      <th>09:18</th>
      <th>09:19</th>
      <th>09:20</th>
      <th>09:21</th>
      <th>09:22</th>
      <th>09:23</th>
      <th>09:24</th>
      <th>...</th>
      <th>15:20</th>
      <th>15:21</th>
      <th>15:22</th>
      <th>15:23</th>
      <th>15:24</th>
      <th>15:25</th>
      <th>15:26</th>
      <th>15:27</th>
      <th>15:28</th>
      <th>15:29</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09</th>
      <td>0.0</td>
      <td>0.09</td>
      <td>-0.06</td>
      <td>0.08</td>
      <td>0.08</td>
      <td>-0.00</td>
      <td>0.00</td>
      <td>0.02</td>
      <td>-0.09</td>
      <td>0.00</td>
      <td>...</td>
      <td>-0.01</td>
      <td>0.02</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.03</td>
      <td>-0.00</td>
      <td>-0.04</td>
      <td>-0.01</td>
      <td>0.01</td>
      <td>-0.03</td>
    </tr>
    <tr>
      <th>2015-01-12</th>
      <td>0.0</td>
      <td>-0.45</td>
      <td>0.01</td>
      <td>0.04</td>
      <td>0.06</td>
      <td>0.05</td>
      <td>-0.02</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>-0.09</td>
      <td>...</td>
      <td>0.04</td>
      <td>-0.04</td>
      <td>0.02</td>
      <td>0.00</td>
      <td>-0.01</td>
      <td>0.04</td>
      <td>0.01</td>
      <td>-0.01</td>
      <td>0.00</td>
      <td>-0.01</td>
    </tr>
    <tr>
      <th>2015-01-13</th>
      <td>0.0</td>
      <td>0.11</td>
      <td>-0.08</td>
      <td>-0.05</td>
      <td>-0.02</td>
      <td>-0.03</td>
      <td>-0.01</td>
      <td>0.01</td>
      <td>-0.09</td>
      <td>-0.09</td>
      <td>...</td>
      <td>0.08</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-0.01</td>
      <td>-0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>2015-01-14</th>
      <td>0.0</td>
      <td>-0.08</td>
      <td>0.07</td>
      <td>0.02</td>
      <td>-0.04</td>
      <td>-0.01</td>
      <td>-0.03</td>
      <td>-0.11</td>
      <td>0.04</td>
      <td>0.12</td>
      <td>...</td>
      <td>0.08</td>
      <td>-0.01</td>
      <td>0.02</td>
      <td>0.03</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>2015-01-15</th>
      <td>0.0</td>
      <td>0.18</td>
      <td>-0.55</td>
      <td>-0.10</td>
      <td>0.18</td>
      <td>0.32</td>
      <td>-0.23</td>
      <td>-0.12</td>
      <td>0.22</td>
      <td>0.06</td>
      <td>...</td>
      <td>-0.04</td>
      <td>-0.07</td>
      <td>-0.11</td>
      <td>-0.06</td>
      <td>-0.11</td>
      <td>-0.05</td>
      <td>0.06</td>
      <td>-0.05</td>
      <td>0.03</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>

<p><br />
To further refine the dataset, we will remove high-stress days. These are days where extreme emotions drive price movements, leading to significant variations. Including such days in the dataset might confuse the model, as it could attempt to scale these outliers alongside normal trading days. By excluding these high-stress days, we aim to create a more consistent dataset that better represents typical market behavior.</p>
<p>By removing these high-stress days, we ensure that the dataset focuses on regular market conditions, which are more representative of typical trading patterns. This adjustment will help the model generalize better and avoid overfitting to rare, extreme scenarios.</p>
<p>To identify and filter out high-stress days, we will use the daily standard deviation as a measure of volatility. Days with a standard deviation outside the range of ±2σ (calculated from the mean daily standard deviation) will be considered high-stress days and excluded from the dataset. Here we calculate the std of every day. And put that in a series then calculate mean and std of that series. So, please don't get confused with <code>std of std</code>.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Calculate daily standard deviation for each trading day</span>
<span class="n">daily_std</span> <span class="o">=</span> <span class="n">n50_daily_price_movements</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># std across columns (time) for each day</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily std statistics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean daily std: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Std of daily std: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min daily std: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max daily std: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the mean and std of daily standard deviations</span>
<span class="n">mean_daily_std</span> <span class="o">=</span> <span class="n">daily_std</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_daily_std</span> <span class="o">=</span> <span class="n">daily_std</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># Define the acceptable range (±2σ)</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">mean_daily_std</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_daily_std</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">mean_daily_std</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_daily_std</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Acceptable daily std range: </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">% to </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Filter days that fall within ±2σ of mean daily std</span>
<span class="n">days_within_2sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">daily_std</span> <span class="o">&gt;=</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">daily_std</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Days analysis:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total days before filtering: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n50_daily_price_movements</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Days within ±2σ: </span><span class="si">{</span><span class="n">days_within_2sigma</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Days to remove: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n50_daily_price_movements</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">days_within_2sigma</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percentage kept: </span><span class="si">{</span><span class="n">days_within_2sigma</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">n50_daily_price_movements</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Apply the filter</span>
<span class="n">n50_daily_price_movements_filtered</span> <span class="o">=</span> <span class="n">n50_daily_price_movements</span><span class="p">[</span><span class="n">days_within_2sigma</span><span class="p">]</span>
<span class="n">n50_daily_opens_filtered</span> <span class="o">=</span> <span class="n">n50_daily_opens</span><span class="p">[</span><span class="n">days_within_2sigma</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Filtered dataset shape:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Price movements: </span><span class="si">{</span><span class="n">n50_daily_price_movements_filtered</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily opens: </span><span class="si">{</span><span class="n">n50_daily_opens_filtered</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Show some examples of removed days (outliers)</span>
<span class="n">outlier_days</span> <span class="o">=</span> <span class="n">n50_daily_price_movements</span><span class="p">[</span><span class="o">~</span><span class="n">days_within_2sigma</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outlier_days</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Examples of removed days (high/low volatility):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highest volatility day: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="si">}</span><span class="s2"> (std: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lowest volatility day: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span><span class="si">}</span><span class="s2"> (std: </span><span class="si">{</span><span class="n">daily_std</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

<span class="n">n50_daily_price_movements_filtered</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<strong>Output</strong>
<div class="highlight"><pre><span></span><code>Daily std statistics:
Mean daily std: 0.0351%
Std of daily std: 0.0211%
Min daily std: 0.0104%
Max daily std: 0.4735%

Acceptable daily std range: -0.0070% to 0.0772%

Days analysis:
Total days before filtering: 2273
Days within ±2σ: 2221
Days to remove: 52
Percentage kept: 97.71%

Filtered dataset shape:
Price movements: (2221, 375)
Daily opens: (2221, 375)

Examples of removed days (high/low volatility):
Highest volatility day: 2020-03-13 (std: 0.4735%)
Lowest volatility day: 2024-03-02 (std: 0.0104%)
</code></pre></div></p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>time</th>
      <th>09:15</th>
      <th>09:16</th>
      <th>09:17</th>
      <th>09:18</th>
      <th>09:19</th>
      <th>09:20</th>
      <th>09:21</th>
      <th>09:22</th>
      <th>09:23</th>
      <th>09:24</th>
      <th>...</th>
      <th>15:20</th>
      <th>15:21</th>
      <th>15:22</th>
      <th>15:23</th>
      <th>15:24</th>
      <th>15:25</th>
      <th>15:26</th>
      <th>15:27</th>
      <th>15:28</th>
      <th>15:29</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-09</th>
      <td>0.0</td>
      <td>0.09</td>
      <td>-0.06</td>
      <td>0.08</td>
      <td>0.08</td>
      <td>-0.00</td>
      <td>0.00</td>
      <td>0.02</td>
      <td>-0.09</td>
      <td>0.00</td>
      <td>...</td>
      <td>-0.01</td>
      <td>0.02</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.03</td>
      <td>-0.00</td>
      <td>-0.04</td>
      <td>-0.01</td>
      <td>0.01</td>
      <td>-0.03</td>
    </tr>
    <tr>
      <th>2015-01-12</th>
      <td>0.0</td>
      <td>-0.45</td>
      <td>0.01</td>
      <td>0.04</td>
      <td>0.06</td>
      <td>0.05</td>
      <td>-0.02</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>-0.09</td>
      <td>...</td>
      <td>0.04</td>
      <td>-0.04</td>
      <td>0.02</td>
      <td>0.00</td>
      <td>-0.01</td>
      <td>0.04</td>
      <td>0.01</td>
      <td>-0.01</td>
      <td>0.00</td>
      <td>-0.01</td>
    </tr>
    <tr>
      <th>2015-01-13</th>
      <td>0.0</td>
      <td>0.11</td>
      <td>-0.08</td>
      <td>-0.05</td>
      <td>-0.02</td>
      <td>-0.03</td>
      <td>-0.01</td>
      <td>0.01</td>
      <td>-0.09</td>
      <td>-0.09</td>
      <td>...</td>
      <td>0.08</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-0.01</td>
      <td>-0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>2015-01-14</th>
      <td>0.0</td>
      <td>-0.08</td>
      <td>0.07</td>
      <td>0.02</td>
      <td>-0.04</td>
      <td>-0.01</td>
      <td>-0.03</td>
      <td>-0.11</td>
      <td>0.04</td>
      <td>0.12</td>
      <td>...</td>
      <td>0.08</td>
      <td>-0.01</td>
      <td>0.02</td>
      <td>0.03</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>2015-01-15</th>
      <td>0.0</td>
      <td>0.18</td>
      <td>-0.55</td>
      <td>-0.10</td>
      <td>0.18</td>
      <td>0.32</td>
      <td>-0.23</td>
      <td>-0.12</td>
      <td>0.22</td>
      <td>0.06</td>
      <td>...</td>
      <td>-0.04</td>
      <td>-0.07</td>
      <td>-0.11</td>
      <td>-0.06</td>
      <td>-0.11</td>
      <td>-0.05</td>
      <td>0.06</td>
      <td>-0.05</td>
      <td>0.03</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>

<p>This cleansing removed 52 days from the market.</p>
<p><em>Most of the blogs and influencers will take only these 52 days. Probably, if we have of all the blogs and youtube transcripts and arrange the dates mentioned in a series, 2σ dates will fall in these 52 days only. You decide whether to make profit in 2221 normal days or you're going to wait for one of those 52 days.</em></p>
<p>Finally, let's split the dataset into training and validation sets and store them as separate files. The model will be trained only on the training dataset. The validation set will not be exposed to the model during training or fine-tuning. We'll use the validation dataset to backtest whether the model is makeing any profit for us.</p>
<p>Let's take out every nineth day into validation set. As it is more than seven, the subsequent nineth day will be different day of the week.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Split into training and validation sets</span>
<span class="c1"># Every 9th day goes to validation, rest goes to training</span>
<span class="n">total_days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n50_daily_price_movements_filtered</span><span class="p">)</span>

<span class="c1"># Create boolean masks for train/validation split</span>
<span class="n">validation_mask</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">9</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_days</span><span class="p">)]</span>  <span class="c1"># Every 9th day (0-indexed, so 8th position)</span>
<span class="n">training_mask</span> <span class="o">=</span> <span class="p">[</span><span class="ow">not</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">validation_mask</span><span class="p">]</span>

<span class="c1"># Split the datasets</span>
<span class="n">train_price_movements</span> <span class="o">=</span> <span class="n">n50_daily_price_movements_filtered</span><span class="p">[</span><span class="n">training_mask</span><span class="p">]</span>
<span class="n">val_price_movements</span> <span class="o">=</span> <span class="n">n50_daily_price_movements_filtered</span><span class="p">[</span><span class="n">validation_mask</span><span class="p">]</span>

<span class="n">train_daily_opens</span> <span class="o">=</span> <span class="n">n50_daily_opens_filtered</span><span class="p">[</span><span class="n">training_mask</span><span class="p">]</span>
<span class="n">val_daily_opens</span> <span class="o">=</span> <span class="n">n50_daily_opens_filtered</span><span class="p">[</span><span class="n">validation_mask</span><span class="p">]</span>

<span class="c1"># Save the datasets to CSV files in the dataset directory</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Create dataset directory if it doesn&#39;t exist</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;dataset&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save training datasets</span>
<span class="n">train_price_movements</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/train_price_movements.csv&#39;</span><span class="p">)</span>
<span class="n">train_daily_opens</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/train_daily_opens.csv&#39;</span><span class="p">)</span>

<span class="c1"># Save validation datasets</span>
<span class="n">val_price_movements</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/val_price_movements.csv&#39;</span><span class="p">)</span>
<span class="n">val_daily_opens</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/val_daily_opens.csv&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datasets saved successfully!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="conclusion">Conclusion</h2>
<p>Let's wrap up this blog here. In the upcoming posts, we will explore various models and training methodologies to determine which approach yields the best results. The dataset prepared in this blog will serve as the foundation for all those experiments. You can access the code discussed in this blog in the <a href="https://github.com/0xba1a/0xba1a.github.com/blob/master/ai_market_prediction/n50_dataset_prep.ipynb">n50_dataset_prep</a> notebook.</p>
<div class="flex">
        <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
        <script type="IN/Share" data-url="https://eastrivervillage.com/blog/2025/08/23/fine-tuning-llms-to-predict-nifty50-prices/"></script>
    </div>







  
  



  


  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://www.linkedin.com/in/balakumaran-kannan/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/0xba1a" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.indexes", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>